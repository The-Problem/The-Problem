/**
 * LimePHP Javascript API
 *
 * Provides an API similar to the LimePHP system
 *
 * @author Tom Barham <me@mrfishie.com>
 * @version 0.0.1
 * @copyright Copyright (c) 2014, Tom Barham
 */
var LimePHP=LimePHP||{};LimePHP.version="0.0.1";(function(){var e;LimePHP.undefined=e;LimePHP.files=[];LimePHP.load=function(){var e=LimePHP.batchrequest($.map(function(e,t){return LimePHP.path(t)},LimePHP.files),"get",LimePHP.undefined,"script");e.success=function(){LimePHP.loadpackages();LimePHP.call("load")}}})();(function(){var e={},t={};LimePHP.register=function(n,r){if(typeof t[n]!=="undefined")return false;e[n]=r;return true};LimePHP.loadpackages=function(){$.each(e,function(e,t){t.call(LimePHP)})};LimePHP.addlibrary=function(e,n){if(typeof t[e]!=="undefined")return false;t[e]={};n(t[e]);return true};LimePHP.library=function(e){if(typeof t[e]==="undefined")return false;return t[e]}})();(function(){LimePHP.Handler=function(e,t,n){this.eventname=e;this.callback=t;this.priority=n};LimePHP.Handler.PRIORITY_LOW=0;LimePHP.Handler.PRIORITY_MEDIUM=2;LimePHP.Handler.PRIORITY_HIGH=4;var e={};LimePHP.listen=function(t){if(typeof e[t.eventname]==="undefined")e[t.eventname]=[];e[t.eventname].push(t)};LimePHP.remove=function(t){$.each(e,function(n,r){if(typeof t==="string"&&n===t)e[n]=[];else{for(var i=0;i<r.length;i++){if(r[i]==t){r.splice(i,1);i--}}}})};LimePHP.call=function(t,n){if(typeof e[t]==="undefined")return false;var r=e[t];r.sort(function(e,t){return e.priority-t.priority});var i=[];for(var s=0;s<r.length;s++){var o=r[s];var u=o.callback.apply(o,n);if(typeof u!=="undefined")i.push(u)}return i}})();(function(){LimePHP.path=function(e){e=String(e).split("\\").join("//");if(e.charAt(0)==="/")e=e.substring(1);var t=LimePHP.SERVER["root"]+e;if(t.charAt(t.length-1)==="/")t=t.substring(0,-1);return t};LimePHP.request=function(e,t,n,r,i){if(typeof n==="undefined")n={};if(typeof r==="undefined")r="json";if(typeof i==="undefined")i={};r=r.toLowerCase();var s={beforeSend:function(){return true},complete:function(){},error:function(){},success:function(){}};var o=$.extend({data:n,dataType:r,type:e,url:t,beforeSend:function(e,t){return s["before"].call(e,t)},complete:function(e,t){return s["complete"].call(e,t)},error:function(e,t,n){return s["error"].call(e,n,t)},success:function(e,t,n){if(r==="json"&&typeof e["error"]!=="undefined")s["error"].call(n,e["error"],"jsonerror");else s["success"].call(n,e,t)}},i);return s};LimePHP.batchrequest=function(e,t,n,r,i){var s={},o={},u=[],a={},f={};for(var l=0;l<e.length;l++){var c=e[l];if(typeof c!=="object")c={path:c};c=$.extend(true,{type:t,path:n,responseType:r,properties:i},c);u.push(LimePHP.request(c.type,c.path,c.responseType,c.properties))}$.each(u,function(t,n){$.each(n,function(t,r){s[t]=r;o[t]=r;a[t]=0;f[t]=[];n[t]=function(){$.each(arguments,function(e,n){if(f.length<e-1)f[t][e]=[];f[t][e].push(n)});a[t]++;if(a[t]>=e)return s[t].apply(this,f[t]);else return o[t].apply(this,f[t])}})});return s}})()